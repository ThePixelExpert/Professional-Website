{
  "permissions": {
    "allow": [
      "Bash(ssh logan@192.168.68.67 \"grep -n 'harbor_admin_password' /home/logan/harbor/harbor.yml\")",
      "Bash(git -C ~/Projects/Professional-Website add DEPLOYMENT.md && git -C ~/Projects/Professional-Website commit -m \"$\\(cat <<'EOF'\ndocs: update DEPLOYMENT.md with lessons learned\n\n- Phase 4: fix hostname to .67, add library project member step,\n  add Harbor password reset procedure\n- Phase 8: fix .env.production location \\(~/\\), variable name\n  \\(STRIPE_PUBLISHABLE_KEY\\), no-leading-spaces warning, SSH key setup\n- Add Known Gotchas table covering all issues hit during initial setup\n\nCo-Authored-By: Claude Sonnet 4.6 <noreply@anthropic.com>\nEOF\n\\)\" && git -C ~/Projects/Professional-Website pull --rebase origin master && git -C ~/Projects/Professional-Website push origin master)",
      "Bash(grep -r \"192.168.68\" /home/logan/Projects/Professional-Website --include=\"*.ts\" --include=\"*.tsx\" --include=\"*.js\" --include=\"*.jsx\" --include=\"*.json\" --include=\"*.env\" --include=\"*.yaml\" --include=\"*.yml\" --include=\"*.conf\" --include=\"*.toml\" -n 2>/dev/null | grep -v \".git/\")",
      "Bash(grep -r \"192.168.68.57\\\\|192.168.68.59\" /home/logan/Projects/Professional-Website -rn --include=\"*.ts\" --include=\"*.tsx\" --include=\"*.js\" --include=\"*.jsx\" --include=\"*.json\" --include=\"*.env*\" --include=\"*.yaml\" --include=\"*.yml\" --include=\"*.conf\" --include=\"*.toml\" 2>/dev/null | grep -v \".git/\")",
      "Bash(grep -r \"admin\" /home/logan/Projects/Professional-Website/src -rn --include=\"*.ts\" --include=\"*.tsx\" -l 2>/dev/null | head -20)",
      "Bash(ssh logan@192.168.68.59 \"grep -rn '192.168.68.57\\\\|192.168.68.59\\\\|API_EXTERNAL_URL\\\\|SUPABASE_PUBLIC_URL\\\\|STUDIO_DEFAULT_PROJECT\\\\|STUDIO_DEFAULT_ORGANIZATION' /opt/supabase/.env 2>/dev/null || grep -rn '192.168.68' /opt/supabase/.env 2>/dev/null || echo 'File not found at /opt/supabase/.env'\" 2>/dev/null)",
      "Bash(ssh -o ConnectTimeout=5 logan@192.168.68.59 \"find / -name '.env' -path '*/supabase*' 2>/dev/null | head -5\" 2>&1)",
      "Bash(ssh logan@192.168.68.59 \"grep -n '192.168.68\\\\|API_EXTERNAL_URL\\\\|SUPABASE_PUBLIC_URL\\\\|SUPABASE_URL\\\\|SITE_URL' /opt/supabase/docker/.env\" 2>&1)",
      "Bash(git add .github/workflows/build-and-push.yml && git commit -m \"ci: add workflow_dispatch trigger\" && git push origin master)",
      "Bash(git add src/components/AdminLogin.js && git commit -m \"fix: remove hash path from OAuth redirectTo to prevent double-hash token parsing failure\" && git push origin master)",
      "Bash(git pull --rebase origin master && git push origin master)",
      "Bash(git add DEPLOYMENT.md && git commit -m \"docs: document OAuth double-hash bug and fix\" && git pull --rebase origin master && git push origin master)",
      "Bash(git add DEPLOYMENT.md && git commit -m \"docs: document admin role setup and login loop troubleshooting\" && git pull --rebase origin master && git push origin master)",
      "Bash(grep -r \"DANGEROUSLY\\\\|disabled\\\\|bypass\" /home/logan/Projects/Professional-Website --include=\"*.env*\" --include=\"*.js\" --include=\"*.jsx\" 2>/dev/null | head -20)",
      "Bash(find /home/logan/Projects/Professional-Website -name \".env*\" -not -path \"*/node_modules/*\" -type f -exec wc -l {} + | sort -n)",
      "Bash(git ls-files contact-backend/.env contact-backend/.env* .env .env* 2>/dev/null)",
      "Bash(ls /home/logan/Projects/Professional-Website/contact-backend/.env* 2>/dev/null)",
      "Bash(git add -A && git status)",
      "Bash(git commit -m \"$\\(cat <<'EOF'\nsecurity: harden backend API and document OAuth auth fixes\n\nBackend security fixes \\(server.js\\):\n- Add helmet middleware for security headers \\(X-Frame-Options, CSP, etc.\\)\n- Add 1mb body size limit to express.json\\(\\) to prevent payload DoS\n- Apply rate limiting to /api/orders/track and /api/orders/:id/customer-receipt\n  \\(previously only /api/contact was rate-limited â€” tracking was brute-forceable\\)\n- Fix payment amount trust: /api/create-payment-intent now looks up the order\n  in the database and uses its server-stored total instead of accepting an\n  amount from the client \\(prevents price manipulation\\)\n- Stripe webhook now rejects requests when STRIPE_WEBHOOK_SECRET is unset\n  \\(previously accepted unverified webhooks silently\\)\n- Remove console.log that dumped full order body including customer PII\n- Remove console.logs exposing user IDs and auth state\n- Add startup warnings when critical env vars are missing in production\n\nDependencies:\n- Add helmet ^8.0.0 to contact-backend/package.json\n\nDocumentation \\(DEPLOYMENT.md\\):\n- Document OAuth callback race condition fix \\(OAuthCallback component, Flux PR #21\\)\n- Document INITIAL_SESSION stale session issue and why it is ignored\n- Document direct raw_app_meta_data approach for admin role when JWT hook\n  is unavailable \\(self-hosted Supabase < v1.24\\)\n- Document multiple Google accounts gotcha \\(role set for wrong account UUID\\)\n\nCo-Authored-By: Claude Sonnet 4.6 <noreply@anthropic.com>\nEOF\n\\)\")",
      "Bash(cd /home/logan/Projects/Professional-Website/contact-backend && npm install --package-lock-only 2>&1 | tail -5)",
      "Bash(git add contact-backend/package-lock.json && git commit -m \"$\\(cat <<'EOF'\nchore: update package-lock.json with helmet dependency\n\nAdds helmet@8.1.0 to the lock file after adding it to package.json.\nPreviously caused npm ci to fail in Docker build.\n\nCo-Authored-By: Claude Sonnet 4.6 <noreply@anthropic.com>\nEOF\n\\)\")",
      "Bash(git push)",
      "Bash(git push --set-upstream origin master)",
      "Bash(git add Dockerfile.frontend .dockerignore && git commit -m \"$\\(cat <<'EOF'\ndebug: print SUPABASE_URL ARG value during frontend build\n\nAdds RUN echo to Dockerfile.frontend to show what value is actually\nbeing baked in, to diagnose why http:// appears in the bundle despite\nthe runner env file showing https://.\n\nAlso excludes .env.production from the Docker build context in\n.dockerignore to prevent accidental inclusion.\n\nCo-Authored-By: Claude Sonnet 4.6 <noreply@anthropic.com>\nEOF\n\\)\")",
      "Bash(git add flux/clusters/production/image-automation/image-policies.yaml && git commit -m \"$\\(cat <<'EOF'\nfix\\(flux\\): switch image policy to numerical timestamp sort\n\nAlphabetical sort on full tag names picks by SHA hex prefix, not\nrecency \\(e.g. main-f9b1f11-... beats main-6c70839-... despite being\nan older build\\). Switch to numerical sort on the extracted timestamp\nso the most recently built image is always selected.\n\nCo-Authored-By: Claude Sonnet 4.6 <noreply@anthropic.com>\nEOF\n\\)\" && git push)",
      "Bash(git add Dockerfile.frontend DEPLOYMENT.md && git diff --cached --stat)",
      "Bash(git commit -m \"$\\(cat <<'EOF'\ndocs: update deployment guide and remove debug echo\n\n- Fix REACT_APP_SUPABASE_URL in Phase 8.4 \\(was http://LAN, must be https://\\)\n- Fix DevPod SSH command \\(professional-website.devpod\\)\n- Note JWT hook may be unavailable in self-hosted Supabase < v1.24\n- Update Known Gotchas #5 \\(numerical timestamp sort, not alphabetical\\)\n- Add gotchas for mixed content, Docker cache, Flux sync order, divergent branches\n- Add troubleshooting: Flux image automation stuck, mixed content http/https, DevPod divergent branch\n- Remove debug RUN echo from Dockerfile.frontend\n\nCo-Authored-By: Claude Sonnet 4.6 <noreply@anthropic.com>\nEOF\n\\)\" && git push)",
      "Bash(git commit -m \"$\\(cat <<'EOF'\nfix: move backend service/endpoints into Flux management with correct VM IP\n\nThe k8s/backend/ Service and Endpoints were manually applied and never\ntracked by Flux. The Endpoints pointed to 192.168.0.50 \\(wrong subnet\\)\ninstead of 192.168.68.64 \\(actual VM IP\\), breaking /api routing through\nTraefik to the backend.\n\nCo-Authored-By: Claude Sonnet 4.6 <noreply@anthropic.com>\nEOF\n\\)\")",
      "Bash(git push origin master)",
      "Bash(git add DEPLOYMENT.md && git commit -m \"$\\(cat <<'EOF'\ndocs: document backend service/endpoints Flux migration and contact form fix\n\nAdded Known Gotcha #15 and troubleshooting entry for the contact form\n503 error caused by missing/incorrect backend-service Endpoints object.\nService and Endpoints are now managed by Flux in\nflux/clusters/production/backend/service.yaml.\n\nCo-Authored-By: Claude Sonnet 4.6 <noreply@anthropic.com>\nEOF\n\\)\")",
      "Bash(git fetch origin && git rebase origin/master)"
    ]
  }
}
